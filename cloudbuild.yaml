timeout: 120s
steps:
    - name: gcr.io/cloud-builders/npm:current
      args:
          - install
    - name: gcr.io/cloud-builders/npm:current
      args:
          - run
          - build
    - name: gcr.io/cloud-builders/npm:current
      entrypoint: 'sudo apt-get'
      args:
          - install
          - libssl1.0.0
          - libssl-dev
          - --reinstall
    - name: gcr.io/cloud-builders/npm:current
      args:
          - run
          - test
      env:
          - MONGOMS_DOWNLOAD_URL=https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian92-4.2.8.tgz
    - name: 'ubuntu'
      entrypoint: 'bash'
      args:
          - '-c'
          - |
              echo //registry.npmjs.org/:_authToken=${_NPM_TOKEN} > .npmrc ;
              echo email=devops@expan.do >> .npmrc ;
              echo always-auth=true >> .npmrc ;
              cat .npmrc ;
      volumes:
          - name: 'home'
            path: /root/
    - name: 'gcr.io/cloud-builders/npm'
      args: ['publish']
      env:
          - HOME=/root/
      volumes:
          - name: 'home'
            path: /root/
